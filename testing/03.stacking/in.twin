# Input file for Stack Fault Energy surface of Aluminum
# Phillip Spear, 2012

# ------------------------ INITIALIZATION ----------------------
units		metal
dimension	3
boundary	p p s
atom_style	atomic
variable	latt_a		equal 4.04
variable	protct		equal 0.01
variable	drange		equal 0.01
variable	x_displace	equal (${latt_a}/sqrt(6))
variable	numb_x		equal 8
variable	numb_y		equal 8
variable	numb_z		equal 24
variable	size_x		equal ${latt_a}*${numb_x}*sqrt(6)/2
variable	size_y		equal ${latt_a}*${numb_y}*sqrt(2)/2
variable	size_z		equal ${latt_a}*${numb_z}*sqrt(3)/3
variable	size_px		equal ${size_x}-${protct}
variable	size_py		equal ${size_y}-${protct}
variable	size_pz		equal ${size_z}-${protct}
variable	bc0_ct		equal ${latt_a}*(7)*sqrt(3)/3
variable	cb0_ct		equal ${latt_a}*(8)*sqrt(3)/3
variable	bc1_ct		equal ${latt_a}*(10)*sqrt(3)/3
variable	cb1_ct		equal ${latt_a}*(11)*sqrt(3)/3
variable	bc0_lo		equal ${bc0_ct}-${drange}
variable	bc0_up		equal ${bc0_ct}+${drange}
variable	cb0_lo		equal ${cb0_ct}-${drange}
variable	cb0_up		equal ${cb0_ct}+${drange}
variable	bc1_lo		equal ${bc1_ct}-${drange}
variable	bc1_up		equal ${bc1_ct}+${drange}
variable	cb1_lo		equal ${cb1_ct}-${drange}
variable	cb1_up		equal ${cb1_ct}+${drange}

# ----------------------- ATOM DEFINITION ----------------------
lattice		fcc ${latt_a}
region		whole block -${protct} ${size_px} -${protct} ${size_py} -${protct} ${size_pz} units box
create_box	1 whole
lattice		fcc ${latt_a} orient x 1 1 2 orient y -1 1 0 orient z -1 -1 1
create_atoms	1 region whole
region		cb0 block  -${protct} ${size_px} -${protct} ${size_py} ${cb0_lo} ${cb0_up} units box
region		cb1 block  -${protct} ${size_px} -${protct} ${size_py} ${cb1_lo} ${cb1_up} units box
region		bc0 block  -${protct} ${size_px} -${protct} ${size_py} ${bc0_lo} ${bc0_up} units box
region		bc1 block  -${protct} ${size_px} -${protct} ${size_py} ${bc1_lo} ${bc1_up} units box
group		cb0 region cb0
group		cb1 region cb1
group		bc0 region bc0
group		bc1 region bc1
mass		1 27

# ----------------------- FORCE FIELDS -----------------------
include		potential.mod

# ------------------------- before disp -----------------------
compute		peratom all pe/atom
compute		eatoms all reduce sum c_peratom
thermo		1
thermo_style	custom step pe pxx pyy pzz c_eatoms
dump		1 all custom 10 dump.relax type xs ys zs c_peratom fx fy fz

fix		1 all setforce 0 0 NULL
min_style	cg
minimize	1e-10 1e-10 1000 1000

run		0
variable	E equal "c_eatoms"
variable	Eo equal $E

# ------------------------- Displacement -----------------------
displace_atoms	bc0 move -${x_displace} 0.0 0.0 units box
displace_atoms	bc1 move -${x_displace} 0.0 0.0 units box
displace_atoms	cb0 move ${x_displace} 0.0 0.0 units box
displace_atoms	cb1 move ${x_displace} 0.0 0.0 units box

fix		1 all setforce 0 0 NULL
min_style	cg
minimize	1e-10 1e-10 1000 1000

run		0
variable	Ef equal "c_eatoms"
variable	Cf equal 1.60217657e-16
variable	A equal (${size_x}*${size_y})*1e-20
variable	SFE equal ((${Ef}-${Eo})*${Cf})/${A}/2.0

# SIMULATION DONE
#print ${x}
print "All done"
print "Initial energy of atoms = ${Eo} eV"
print "Final energy of atoms = ${Ef} eV"
print "Twin energy = ${SFE} mJ/m^2"
